{% extends "base.html" %}

{% block content %}
<div class="dashboard-header text-center mb-5">
    <h1 class="display-5 text-primary mb-3">
        <i class="fas fa-tachometer-alt me-2"></i>
        Financial Dashboard
    </h1>
    <p class="lead text-muted">Your complete financial overview with interactive analytics</p>
</div>

<!-- Summary Cards -->
<div class="row mb-5" id="summaryCards">
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card border-0 shadow-sm h-100 income-card">
            <div class="card-body text-center p-4">
                <div class="card-icon mb-3">
                    <i class="fas fa-arrow-up fa-2x text-success"></i>
                </div>
                <h3 class="card-title text-success mb-2">${{ "%.2f"|format(summary.total_income) }}</h3>
                <p class="card-text text-muted">Total Income</p>
                <small class="text-success">
                    <i class="fas fa-chart-line me-1"></i>
                    {{ summary.income_transactions }} transactions
                </small>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card border-0 shadow-sm h-100 expense-card">
            <div class="card-body text-center p-4">
                <div class="card-icon mb-3">
                    <i class="fas fa-arrow-down fa-2x text-danger"></i>
                </div>
                <h3 class="card-title text-danger mb-2">${{ "%.2f"|format(summary.total_expenses) }}</h3>
                <p class="card-text text-muted">Total Expenses</p>
                <small class="text-danger">
                    <i class="fas fa-chart-line me-1"></i>
                    {{ summary.expense_transactions }} transactions
                </small>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card border-0 shadow-sm h-100 savings-card">
            <div class="card-body text-center p-4">
                <div class="card-icon mb-3">
                    <i class="fas fa-piggy-bank fa-2x text-primary"></i>
                </div>
                <h3 class="card-title {% if summary.net_savings >= 0 %}text-success{% else %}text-danger{% endif %} mb-2">
                    ${{ "%.2f"|format(summary.net_savings) }}
                </h3>
                <p class="card-text text-muted">Net Savings</p>
                <small class="{% if summary.net_savings >= 0 %}text-success{% else %}text-danger{% endif %}">
                    <i class="fas fa-percentage me-1"></i>
                    {% if summary.total_income > 0 %}
                        {{ "%.1f"|format((summary.net_savings / summary.total_income) * 100) }}% savings rate
                    {% else %}
                        N/A
                    {% endif %}
                </small>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card border-0 shadow-sm h-100 largest-card">
            <div class="card-body text-center p-4">
                <div class="card-icon mb-3">
                    <i class="fas fa-star fa-2x text-warning"></i>
                </div>
                <h3 class="card-title text-warning mb-2">${{ "%.2f"|format(summary.largest_income) }}</h3>
                <p class="card-text text-muted">Largest Income</p>
                <small class="text-muted">
                    <i class="fas fa-credit-card me-1"></i>
                    Single transaction
                </small>
            </div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="row">
    <!-- Expense Categories Pie Chart -->
    <div class="col-lg-6 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-pie me-2 text-primary"></i>
                    Expense Categories
                </h5>
            </div>
            <div class="card-body">
                <div id="expensePieChart" class="chart-container"></div>
            </div>
        </div>
    </div>
    
    <!-- Income Sources Pie Chart -->
    <div class="col-lg-6 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-pie me-2 text-success"></i>
                    Income Sources
                </h5>
            </div>
            <div class="card-body">
                <div id="incomePieChart" class="chart-container"></div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Monthly Trends -->
    <div class="col-lg-12 mb-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-line me-2 text-info"></i>
                    Monthly Income vs Expenses
                </h5>
            </div>
            <div class="card-body">
                <div id="monthlyTrendsChart" class="chart-container"></div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Category Bar Chart -->
    <div class="col-lg-6 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-bar me-2 text-warning"></i>
                    Top Expense Categories
                </h5>
            </div>
            <div class="card-body">
                <div id="categoryBarChart" class="chart-container"></div>
            </div>
        </div>
    </div>
    
    <!-- Cumulative Savings -->
    <div class="col-lg-6 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-area me-2 text-purple"></i>
                    Cumulative Savings
                </h5>
            </div>
            <div class="card-body">
                <div id="cumulativeSavingsChart" class="chart-container"></div>
            </div>
        </div>
    </div>
</div>

<!-- Insights Section -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm bg-light">
            <div class="card-header bg-gradient text-white py-3">
                <h5 class="card-title mb-0">
                    <i class="fas fa-lightbulb me-2"></i>
                    Smart Insights
                </h5>
            </div>
            <div class="card-body">
                <div id="insightsContainer">
                    <div class="d-flex justify-content-center p-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading insights...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div class="row mt-4">
    <div class="col-12 text-center">
        <a href="{{ url_for('index') }}" class="btn btn-outline-primary btn-lg me-3">
            <i class="fas fa-upload me-2"></i>
            Upload New File
        </a>
        <button class="btn btn-primary btn-lg" onclick="refreshDashboard()">
            <i class="fas fa-sync-alt me-2"></i>
            Refresh Analysis
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}